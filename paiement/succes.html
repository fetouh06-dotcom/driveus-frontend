<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paiement rÃ©ussi â€” DriveUs</title>
  <link rel="stylesheet" href="/assets/style.css" />
  <script src="/assets/config.js"></script>
  <script>
    (function(){
      const id = window.DRIVEUS_CONFIG?.GA_MEASUREMENT_ID;
      if (!id) return;
      const s = document.createElement('script');
      s.async = true;
      s.src = `https://www.googletagmanager.com/gtag/js?id=${encodeURIComponent(id)}`;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', id, { send_page_view: true });
    })();
  </script>
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <a class="brand" href="/">
        <span class="brand__mark">ðŸš˜</span>
        <span class="brand__text"><strong>DriveUs</strong><span>Chauffeur VTC</span></span>
      </a>
      <a class="cta cta--small" href="/">Accueil</a>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <div class="card" style="padding:18px">
        <h2>Paiement effectuÃ© âœ…</h2>
        <p class="muted">Merci ! Votre rÃ©servation est confirmÃ©e (ou en cours de confirmation).</p>

        <div class="summary">
          <div class="summary__row"><span>Booking ID</span><strong id="bid">â€”</strong></div>
          <div class="summary__row"><span>Session ID</span><strong id="sid">â€”</strong></div>
          <div class="summary__row summary__row--total"><span>Acompte</span><strong id="val">â€”</strong></div>
          <div class="divider"></div>
          <div class="muted small">Si besoin, contacte <a href="mailto:contact@driveus.fr">contact@driveus.fr</a></div>
        </div>

        <div class="actions">
          <a class="btn" href="/">Nouvelle rÃ©servation</a>
        </div>
      </div>
    </div>
  </main>

  <script>
    const p = new URLSearchParams(location.search);
    const bookingId = p.get("booking_id") || (function(){ try { return localStorage.getItem("driveus_last_booking_id"); } catch(e){ return ""; } })() || "";
    const sessionId = p.get("session_id") || "";

    document.getElementById("bid").textContent = bookingId || "â€”";
    document.getElementById("sid").textContent = sessionId || "â€”";

    const API_BASE = (window.DRIVEUS_CONFIG && window.DRIVEUS_CONFIG.API_BASE) ? window.DRIVEUS_CONFIG.API_BASE : "https://api.driveus.fr";

    async function loadDeposit() {
      try {
        const r = await fetch(`${API_BASE}/api/public-config`, { cache: "no-store" });
        const data = await r.json();
        const v = Number(data.depositEur);
        return Number.isFinite(v) && v > 0 ? v : 10;
      } catch (e) {
        return 10;
      }
    }

    (async () => {
      const deposit = await loadDeposit();
      document.getElementById("val").textContent = deposit.toFixed(2).replace(".", ",") + " â‚¬";

      // Tracking conversion (GA4 purchase) â€” optional
      if (typeof window.gtag === "function") {
        window.gtag("event", "purchase", {
          currency: "EUR",
          value: deposit,
          transaction_id: sessionId || ("driveus-" + Date.now()),
          items: [{ item_name: "Acompte VTC", price: deposit, quantity: 1 }]
        });
        window.gtag("event", "driveus_payment_success", { booking_id: bookingId, session_id: sessionId });
      }
    })();
  </script>
</body>